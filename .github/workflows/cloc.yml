name: Code Line Counter

on:
  workflow_dispatch:   # å…è®¸æ‰‹åŠ¨è§¦å‘
  schedule:
    - cron: '0 0 * * 0'  # æ¯å‘¨æ—¥è‡ªåŠ¨è¿è¡Œï¼ˆå¯é€‰ï¼‰

jobs:
  count-lines:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Run cloc
      id: cloc
      uses: himangshuj/gh-action-cloc@v1
      with:
        args: |
          --exclude-dir=node_modules,.git,dist,build,venv  # æŽ’é™¤ç›®å½•
          --exclude-ext=log,lock,md,json                   # æŽ’é™¤æ‰©å±•å
          
    - name: Create report
      run: |
        echo "ðŸ“Š ä»£ç ç»Ÿè®¡æŠ¥å‘Š ($(date +'%Y-%m-%d'))" > cloc-report.md
        echo "==================================" >> cloc-report.md
        echo "è¯­è¨€ | æ–‡ä»¶æ•° | ç©ºè¡Œ | æ³¨é‡Š | ä»£ç " >> cloc-report.md
        echo "---|---|---|---|---" >> cloc-report.md
        cat cloc.txt | tail -n +3 | head -n -2 | while read line; do
          echo $line | awk '{print $1 " | " $2 " | " $3 " | " $4 " | " $5}' >> cloc-report.md
        done
        
        echo "\n### æ±‡æ€»ç»Ÿè®¡" >> cloc-report.md
        cat cloc.txt | tail -1 | awk '{print "æ€»æ–‡ä»¶æ•°: **" $2 "**<br>æ€»ä»£ç è¡Œ: **" $5 "**"}' >> cloc-report.md
        
        echo "\nðŸ•’ ç»Ÿè®¡æ—¶é—´: $(date)" >> cloc-report.md
        
    - name: Upload report
      uses: actions/upload-artifact@v3
      with:
        name: code-stats
        path: |
          cloc.txt
          cloc-report.md
